# LiveHTML Gulp сборщик. Pug + Sass/SCSS.

Сборка основана на [Gulppack](https://github.com/andreyalexeich/gulppack-pug), однако многое переписано и улучшено. Из описания Gulppack: сборка для автоматизации задач в повседневной front-end разработке. Компилируйте SCSS и Pug, сжимайте файлы, оптимизируйте картинки, пишите на ES6. При  каждом сохранении файла в редакторе кода браузер автоматически перезагружает страницу. Не волнуйтесь о том, что вам придётся выполнять рутинную работу.

## Что включает в себя сборка?
* [browser-sync](https://browsersync.io/docs/gulp) - живая перезагрузка веб-страницы при внесении изменений в файлы вашего проекта;
* [gulp-autoprefixer](https://www.npmjs.com/package/gulp-autoprefixer) — автоматически расставляет префиксы в CSS в соответствии с сервисом [Can I Use](https://caniuse.com/);
* [gulp-babel](https://www.npmjs.com/package/gulp-babel) - использование ES6 с [Babel](https://babeljs.io/);
* [gulp-uglify](https://www.npmjs.com/package/gulp-uglify) — минификация JS-файлов;
* [gulp-pug](https://www.npmjs.com/package/gulp-pug) — компиляция Pug в HTML;
* [gulp-sass](https://www.npmjs.com/package/gulp-sass) — компиляция Sass/SCSS в CSS;
* [gulp-clean-css](https://www.npmjs.com/package/gulp-clean-css) — минификация CSS-файлов;
* [gulp-sourcemaps](https://www.npmjs.com/package/gulp-sourcemaps) - карта стилей;
* [gulp-concat](https://www.npmjs.com/package/gulp-concat) - объединение файлов;
* [gulp-add-src](https://www.npmjs.com/package/gulp-add-src) — добавление файлов для объединения;
* [gulp-rename](https://www.npmjs.com/package/gulp-rename) — переименование файлов, добавление суффиксов и префиксов (например, добавление суффикса .min к минифицированным файлам);
* [gulp-imagemin](https://www.npmjs.com/package/gulp-imagemin) — сжатие изображений PNG, JPG, GIF и SVG;
* [imagemin-pngquant](https://www.npmjs.com/package/imagemin-pngquant) — дополнение к gulp-imagemin для работы с PNG-изображениями;
* [imagemin-jpeg-recompress](https://www.npmjs.com/package/imagemin-jpeg-recompress) — дополнение к gulp-imagemin для работы с JPG-изображениями;
* [gulp-webp](https://github.com/sindresorhus/gulp-webp) — создание и оптимизация изображений в формате WebP;
* [gulp-favicons](https://github.com/evilebottnawi/favicons) — генератор фавиконок для вашего проекта;
* [gulp-svg-sprite](https://www.npmjs.com/package/gulp-svg-sprite) — создание SVG-спрайтов;
* [gulp-replace](https://www.npmjs.com/package/gulp-replace) - замена строк в исходных файлах;
* [gulp-newer](https://www.npmjs.com/package/gulp-newer) — дополнительный плагин к ```gulp-imagemin```, позволяет сжимать только новые изображения;
* [gulp-plumber](https://www.npmjs.com/package/gulp-plumber) — оповещения в командной строке (например, ошибки в Sass/SCSS);
* [gulp-debug](https://www.npmjs.com/package/gulp-debug) — отладка в терминале;
* [gulp-watch](https://www.npmjs.com/package/gulp-watch) — отслеживание изменений в ваших файлах проекта;
* [gulp-clean](https://www.npmjs.com/package/gulp-clean) — удаление файлов и папок.

## Как подготовиться?

* [NPM](https://nodejs.org/) или [Yarn](https://yarnpkg.com/en/docs/install) (рекомендуется, гораздо быстрее) должен быть установлен;
* ```gulp``` должен быть установлен глобально: ```npm install -g gulp-cli``` или ```yarn global add gulp-cli```;
* скачайте вёрстку как zip и распакуйте или клонируйте с гита (возможно, вы уже сделали это, если читаете данный документ);
* перейдите в папку с исходниками: ```cd sources```;
* введите команду, которая скачает необходимые компоненты для корректной работы сборщика: ```npm install``` или ```yarn```;

## Как собрать?

Проект собирается в папку ```html``` рядом с ```sources```.

У нас открыт терминал, рабочая директория — ```sources```
Запускаем: ```gulp```

![](https://myscreenshot.ru/rv6wj.png)

Если вы всё сделали правильно, у вас должен открыться браузер с локальным сервером и работающим browser-sync. Сборка прошла успешно, вёрстка в папке ```html``` полностью обновлена из текущих исходников.

Одновременно запущен мониторинг на следующие директории:
* ```sources/src/pug/**/*.pug```
* ```sources/src/sass/**/*.{scss,sass}```
* ```sources/src/fonts/**/*```
* ```sources/src/images/**/*``` — все картинки проходят автоматическое сжатие
* ```sources/src/images/favicons/*``` — из одной картинки генерируется необходимый набор фавиконок
* ```sources/src/images/skip-optimization/**/*``` — здесь картинки минуют оптимизацию
* ```sources/src/images/sprite-svg/*.svg``` — здесь svg собираются в один спрайт
* ```sources/src/js/**/*.js``` — из js файлов собирается один main.min.js

Для останавки мониторинга и локального сервера нажмите ```Ctrl + C``` в терминале.


## Sass vs SCSS

Сборщик поддерживает оба формата. Единственное условие — один .sass или .scss файл должен быть написан либо на чистом sass синтаксисе, либо scss. При этом разные файлы, которые вы имортируете, могут быть по разному и написаны (.sass или .scss соответственно).


## Оптимизация изображений

Сборщик проводит автоматическое сжатие изображений, приоритет отдан максимальному визуальному качеству, без явных артефактов на любых дисплеях. Учитывая это, Google PageSpeed или другие аналогичные инструменты анализа сжатия изображений, могут сообщать о необходимости ещё сжать изображения — решать вам, что важнее. Изменить степень сжатия можно соответствующими параметрами в ```sources/gulp/tasks/images.js``` и перезапустить сборку ```gulp```.

**JPG**: оптимизация настроена и отлично работает, главное — использовать JPG с качеством 100% (без какого-либо первоначального сжатия).

**PNG**: оптимизация настроена и работает хорошо. В некоторых случаях TinyPNG будет лучше (по качеству и/или степени сжатия), но в целом результат близкий. PNG также сохранять оригинальный (PNG24), без сжатия и/или каких-либо оптимизаций.

**SVG**: оптимизация настроена и работает отлично. Однако сам по себе формат svg очень сложный, он может включать внутри в том числе и растровую графику(!), анимации, поэтому не исключена потеря/искажение svg на выходе (в таком случае воспользуйтесь советом ниже). Тем не менее, при тестировании, каких-либо проблем с данным оптимизатором не выявлено.

В сборке присутствует папка ```sources/src/images/skip-optimization/``` — все файлы из неё копируются без какого-либо вмешательства сразу в ```html/images/```.
Сделано на случай, если вдруг какой-то из оптимизаторов сработал плохо для того или иного изображения (оптимизируем вручную в таком случае).
**Внимание:** сохраняя файл в ```sources/src/images/skip-optimization/``` убедитесь, что нет файла с таким же именем в основной папке ```sources/src/images/```.

## Изображения в формате WebP

В сборщик встроена возможность автоматического создания и оптимизации формата WebP. Для этого используем папку ```sources/src/images/webp/``` — все изображения (любого формата) из неё автоматически конвертируются с оптимизацией в формат WebP и сохраняются в основной поток ```html/images/```. Качество конвертации — 85. Достаточно для большинства случаев, но если нужен меньший вес или, наоборот, лучшее качество, то данный параметр можно изменить в ```sources/gulp/tasks/images.js``` и перезапустить gulp.

Одни и те же изображения, с теми же именами, можно одновременно сохранять в ```sources/src/images/webp/``` и в ```sources/src/images/```. На выходе все будут в одной папке, но со своими расширениями.

## Иконочный шрифт? Больше не используем!

Вместо него — svg спрайты. Шрифт использовали ранее для максимальной кроссбраузерности, сейчас это не актуально. Подробное сравнение [здесь](https://css-tricks.com/icon-fonts-vs-svg/).


## Bower или подключение плагинов (в том числе таких как jQuery, slick и др.)

Раньше для автоматического скачивания библиотек, плагинов был популярен Bower, сейчас практически все поддерживают добавление через NPM или Yarn.

Например, вам нужен [jQuery](https://jquery.com/) (возможно уже используется в вёрстке), вводим команду: ```npm install jquery``` или ```yarn add jquery```.

Либа скачается в ```souces/node_modules```, а также будет прописана зависимость в ```sources/package.json```, секция ```dependencies```.
Когда зависимость уже прописана — данные команды не нужны, все автоматически скачается при развертывании проекта (```npm install``` или ```yarn```).
Для удаления: ```npm uninstall jquery``` или ```yarn remove jquery```. Также можно вручную почистить ```sources/package.json``` и запустить ```npm install``` или ```yarn```.
Примечание: удаленные таким образом либы автоматически **не удаляются** из ```sources/src/libs```. Всё лишнее чистим там вручную.

Далее запускаем: ```gulp``` — либы целиком скопируются в ```sources/src/libs```. Там будут в том числе исходные файлы, документация.
В вёрстке обычно используются только собранные минифицированные дистрибутивы, чаще всего они в папке ```dist```.

Путь к библиотекам прописывается в ```sources/src/js/_libs_concat.js```.
При сборке все JS сливаются в один файл ```html/js/main.min.js``` он и подключен в pug ```sources/src/pug/base/_layout.pug```.

## Вопросы, замечания, предложения?

Пишите нам [на сайте](https://livehtml.io/tasks), hello@livehtml.io или Telegram/Skype/WhatsApp/Viber: +375445954030